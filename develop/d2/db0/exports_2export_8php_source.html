<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dolibarr: htdocs/exports/export.php Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../dolibarr.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Dolibarr
   &#160;<span id="projectnumber">develop</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d2/db0/exports_2export_8php_source.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">export.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d2/db0/exports_2export_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/* Copyright (C) 2005-2018  Laurent Destailleur &lt;eldy@users.sourceforge.net&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Copyright (C) 2005-2012  Regis Houssin       &lt;regis.houssin@inodbox.com&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2012       Marcos Garc√≠a       &lt;marcosgdf@gmail.com&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Copyright (C) 2012       Charles-Fr BENKE    &lt;charles.fr@benke.fr&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Copyright (C) 2015       Juanjo Menent       &lt;jmenent@2byte.es&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * the Free Software Foundation; either version 3 of the License, or</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * (at your option) any later version.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * along with this program. If not, see &lt;https://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;require_once <span class="stringliteral">&#39;../main.inc.php&#39;</span>;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/class/html.formfile.class.php&#39;</span>;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/class/html.formother.class.php&#39;</span>;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/exports/class/export.class.php&#39;</span>;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/modules/export/modules_export.php&#39;</span>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/lib/files.lib.php&#39;</span>;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">// Load translation files required by the page</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;$langs-&gt;loadlangs(array(<span class="stringliteral">&#39;admin&#39;</span>, <span class="stringliteral">&#39;exports&#39;</span>, <span class="stringliteral">&#39;other&#39;</span>, <span class="stringliteral">&#39;users&#39;</span>, <span class="stringliteral">&#39;companies&#39;</span>, <span class="stringliteral">&#39;projects&#39;</span>, <span class="stringliteral">&#39;suppliers&#39;</span>, <span class="stringliteral">&#39;products&#39;</span>, <span class="stringliteral">&#39;bank&#39;</span>, <span class="stringliteral">&#39;bills&#39;</span>));</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">// Everybody should be able to go on this page</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">//if (! $user-&gt;admin)</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">//  accessforbidden();</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">// Map icons, array duplicated in import.php, was not synchronized, TODO put it somewhere only once</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;$entitytoicon = array(</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="stringliteral">&#39;invoice&#39;</span>      =&gt; <span class="stringliteral">&#39;bill&#39;</span>,</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="stringliteral">&#39;invoice_line&#39;</span> =&gt; <span class="stringliteral">&#39;bill&#39;</span>,</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="stringliteral">&#39;order&#39;</span>        =&gt; <span class="stringliteral">&#39;order&#39;</span>,</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="stringliteral">&#39;order_line&#39;</span>   =&gt; <span class="stringliteral">&#39;order&#39;</span>,</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="stringliteral">&#39;propal&#39;</span>       =&gt; <span class="stringliteral">&#39;propal&#39;</span>,</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="stringliteral">&#39;propal_line&#39;</span>  =&gt; <span class="stringliteral">&#39;propal&#39;</span>,</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="stringliteral">&#39;intervention&#39;</span> =&gt; <span class="stringliteral">&#39;intervention&#39;</span>,</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="stringliteral">&#39;inter_line&#39;</span>   =&gt; <span class="stringliteral">&#39;intervention&#39;</span>,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="stringliteral">&#39;member&#39;</span>       =&gt; <span class="stringliteral">&#39;user&#39;</span>,</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="stringliteral">&#39;member_type&#39;</span>  =&gt; <span class="stringliteral">&#39;group&#39;</span>,</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="stringliteral">&#39;subscription&#39;</span> =&gt; <span class="stringliteral">&#39;payment&#39;</span>,</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="stringliteral">&#39;payment&#39;</span>      =&gt; <span class="stringliteral">&#39;payment&#39;</span>,</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="stringliteral">&#39;tax&#39;</span>          =&gt; <span class="stringliteral">&#39;generic&#39;</span>,</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="stringliteral">&#39;tax_type&#39;</span>     =&gt; <span class="stringliteral">&#39;generic&#39;</span>,</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="stringliteral">&#39;other&#39;</span>        =&gt; <span class="stringliteral">&#39;generic&#39;</span>,</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="stringliteral">&#39;account&#39;</span>      =&gt; <span class="stringliteral">&#39;account&#39;</span>,</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="stringliteral">&#39;product&#39;</span>      =&gt; <span class="stringliteral">&#39;product&#39;</span>,</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="stringliteral">&#39;virtualproduct&#39;</span>=&gt;<span class="stringliteral">&#39;product&#39;</span>,</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="stringliteral">&#39;subproduct&#39;</span>   =&gt; <span class="stringliteral">&#39;product&#39;</span>,</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="stringliteral">&#39;product_supplier_ref&#39;</span>      =&gt; <span class="stringliteral">&#39;product&#39;</span>,</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="stringliteral">&#39;stock&#39;</span>        =&gt; <span class="stringliteral">&#39;stock&#39;</span>,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="stringliteral">&#39;warehouse&#39;</span>    =&gt; <span class="stringliteral">&#39;stock&#39;</span>,</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="stringliteral">&#39;batch&#39;</span>        =&gt; <span class="stringliteral">&#39;stock&#39;</span>,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="stringliteral">&#39;stockbatch&#39;</span>   =&gt; <span class="stringliteral">&#39;stock&#39;</span>,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="stringliteral">&#39;category&#39;</span>     =&gt; <span class="stringliteral">&#39;category&#39;</span>,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="stringliteral">&#39;shipment&#39;</span>     =&gt; <span class="stringliteral">&#39;sending&#39;</span>,</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="stringliteral">&#39;shipment_line&#39;</span>=&gt; <span class="stringliteral">&#39;sending&#39;</span>,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="stringliteral">&#39;reception&#39;</span>=&gt; <span class="stringliteral">&#39;sending&#39;</span>,</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="stringliteral">&#39;reception_line&#39;</span>=&gt; <span class="stringliteral">&#39;sending&#39;</span>,</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="stringliteral">&#39;expensereport&#39;</span>=&gt; <span class="stringliteral">&#39;trip&#39;</span>,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="stringliteral">&#39;expensereport_line&#39;</span>=&gt; <span class="stringliteral">&#39;trip&#39;</span>,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="stringliteral">&#39;holiday&#39;</span>      =&gt; <span class="stringliteral">&#39;holiday&#39;</span>,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="stringliteral">&#39;contract_line&#39;</span> =&gt; <span class="stringliteral">&#39;contract&#39;</span>,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="stringliteral">&#39;translation&#39;</span>  =&gt; <span class="stringliteral">&#39;generic&#39;</span>,</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="stringliteral">&#39;bomm&#39;</span>         =&gt; <span class="stringliteral">&#39;bom&#39;</span>,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="stringliteral">&#39;bomline&#39;</span>      =&gt; <span class="stringliteral">&#39;bom&#39;</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">// Translation code, array duplicated in import.php, was not synchronized, TODO put it somewhere only once</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;$entitytolang = array(</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="stringliteral">&#39;user&#39;</span>         =&gt; <span class="stringliteral">&#39;User&#39;</span>,</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="stringliteral">&#39;company&#39;</span>      =&gt; <span class="stringliteral">&#39;Company&#39;</span>,</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="stringliteral">&#39;contact&#39;</span>      =&gt; <span class="stringliteral">&#39;Contact&#39;</span>,</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="stringliteral">&#39;invoice&#39;</span>      =&gt; <span class="stringliteral">&#39;Bill&#39;</span>,</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="stringliteral">&#39;invoice_line&#39;</span> =&gt; <span class="stringliteral">&#39;InvoiceLine&#39;</span>,</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="stringliteral">&#39;order&#39;</span>        =&gt; <span class="stringliteral">&#39;Order&#39;</span>,</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="stringliteral">&#39;order_line&#39;</span>   =&gt; <span class="stringliteral">&#39;OrderLine&#39;</span>,</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="stringliteral">&#39;propal&#39;</span>       =&gt; <span class="stringliteral">&#39;Proposal&#39;</span>,</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="stringliteral">&#39;propal_line&#39;</span>  =&gt; <span class="stringliteral">&#39;ProposalLine&#39;</span>,</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="stringliteral">&#39;intervention&#39;</span> =&gt; <span class="stringliteral">&#39;Intervention&#39;</span>,</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="stringliteral">&#39;inter_line&#39;</span>   =&gt; <span class="stringliteral">&#39;InterLine&#39;</span>,</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="stringliteral">&#39;member&#39;</span>       =&gt; <span class="stringliteral">&#39;Member&#39;</span>,</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="stringliteral">&#39;member_type&#39;</span>  =&gt; <span class="stringliteral">&#39;MemberType&#39;</span>,</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="stringliteral">&#39;subscription&#39;</span> =&gt; <span class="stringliteral">&#39;Subscription&#39;</span>,</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="stringliteral">&#39;tax&#39;</span>          =&gt; <span class="stringliteral">&#39;SocialContribution&#39;</span>,</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="stringliteral">&#39;tax_type&#39;</span>     =&gt; <span class="stringliteral">&#39;DictionarySocialContributions&#39;</span>,</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="stringliteral">&#39;account&#39;</span>      =&gt; <span class="stringliteral">&#39;BankTransactions&#39;</span>,</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="stringliteral">&#39;payment&#39;</span>      =&gt; <span class="stringliteral">&#39;Payment&#39;</span>,</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="stringliteral">&#39;product&#39;</span>      =&gt; <span class="stringliteral">&#39;Product&#39;</span>,</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="stringliteral">&#39;virtualproduct&#39;</span>  =&gt; <span class="stringliteral">&#39;AssociatedProducts&#39;</span>,</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="stringliteral">&#39;subproduct&#39;</span>      =&gt; <span class="stringliteral">&#39;SubProduct&#39;</span>,</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="stringliteral">&#39;product_supplier_ref&#39;</span>      =&gt; <span class="stringliteral">&#39;SupplierPrices&#39;</span>,</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="stringliteral">&#39;service&#39;</span>      =&gt; <span class="stringliteral">&#39;Service&#39;</span>,</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="stringliteral">&#39;stock&#39;</span>        =&gt; <span class="stringliteral">&#39;Stock&#39;</span>,</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="stringliteral">&#39;movement&#39;</span>     =&gt; <span class="stringliteral">&#39;StockMovement&#39;</span>,</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="stringliteral">&#39;batch&#39;</span>        =&gt; <span class="stringliteral">&#39;Batch&#39;</span>,</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="stringliteral">&#39;stockbatch&#39;</span>   =&gt; <span class="stringliteral">&#39;StockDetailPerBatch&#39;</span>,</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="stringliteral">&#39;warehouse&#39;</span>    =&gt; <span class="stringliteral">&#39;Warehouse&#39;</span>,</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="stringliteral">&#39;category&#39;</span>     =&gt; <span class="stringliteral">&#39;Category&#39;</span>,</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="stringliteral">&#39;other&#39;</span>        =&gt; <span class="stringliteral">&#39;Other&#39;</span>,</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="stringliteral">&#39;trip&#39;</span>         =&gt; <span class="stringliteral">&#39;TripsAndExpenses&#39;</span>,</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="stringliteral">&#39;shipment&#39;</span>     =&gt; <span class="stringliteral">&#39;Shipments&#39;</span>,</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="stringliteral">&#39;shipment_line&#39;</span>=&gt; <span class="stringliteral">&#39;ShipmentLine&#39;</span>,</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="stringliteral">&#39;project&#39;</span>      =&gt; <span class="stringliteral">&#39;Projects&#39;</span>,</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="stringliteral">&#39;projecttask&#39;</span>  =&gt; <span class="stringliteral">&#39;Tasks&#39;</span>,</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="stringliteral">&#39;task_time&#39;</span>    =&gt; <span class="stringliteral">&#39;TaskTimeSpent&#39;</span>,</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="stringliteral">&#39;action&#39;</span>       =&gt; <span class="stringliteral">&#39;Event&#39;</span>,</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="stringliteral">&#39;expensereport&#39;</span>=&gt; <span class="stringliteral">&#39;ExpenseReport&#39;</span>,</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="stringliteral">&#39;expensereport_line&#39;</span>=&gt; <span class="stringliteral">&#39;ExpenseReportLine&#39;</span>,</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="stringliteral">&#39;holiday&#39;</span>      =&gt; <span class="stringliteral">&#39;TitreRequestCP&#39;</span>,</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="stringliteral">&#39;contract&#39;</span>     =&gt; <span class="stringliteral">&#39;Contract&#39;</span>,</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="stringliteral">&#39;contract_line&#39;</span>=&gt; <span class="stringliteral">&#39;ContractLine&#39;</span>,</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="stringliteral">&#39;translation&#39;</span>  =&gt; <span class="stringliteral">&#39;Translation&#39;</span>,</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="stringliteral">&#39;bom&#39;</span>          =&gt; <span class="stringliteral">&#39;BOM&#39;</span>,</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="stringliteral">&#39;bomline&#39;</span>      =&gt; <span class="stringliteral">&#39;BOMLine&#39;</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;$array_selected = isset($_SESSION[<span class="stringliteral">&quot;export_selected_fields&quot;</span>]) ? $_SESSION[<span class="stringliteral">&quot;export_selected_fields&quot;</span>] : array();</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;$array_filtervalue = isset($_SESSION[<span class="stringliteral">&quot;export_filtered_fields&quot;</span>]) ? $_SESSION[<span class="stringliteral">&quot;export_filtered_fields&quot;</span>] : array();</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;$datatoexport = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;datatoexport&quot;</span>, <span class="stringliteral">&quot;aZ09&quot;</span>);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;$action = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;action&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;$confirm = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;confirm&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;$step = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;step&quot;</span>, <span class="stringliteral">&quot;int&quot;</span>) ?<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;step&quot;</span>, <span class="stringliteral">&quot;int&quot;</span>) : 1;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;$export_name = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;export_name&quot;</span>, <span class="stringliteral">&quot;alphanohtml&quot;</span>);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;$hexa = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;hexa&quot;</span>, <span class="stringliteral">&quot;alpha&quot;</span>);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;$exportmodelid = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;exportmodelid&quot;</span>, <span class="stringliteral">&quot;int&quot;</span>);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;$field = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;field&quot;</span>, <span class="stringliteral">&quot;alpa&quot;</span>);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;$objexport = <span class="keyword">new</span> <a class="code" href="../../de/de5/class_export.html">Export</a>($db);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;$objexport-&gt;load_arrays($user, $datatoexport);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;$objmodelexport = <span class="keyword">new</span> <a class="code" href="../../d5/d32/class_modele_exports.html">ModeleExports</a>($db);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;$form = <span class="keyword">new</span> <a class="code" href="../../df/d08/class_form.html">Form</a>($db);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;$htmlother = <span class="keyword">new</span> <a class="code" href="../../d0/dbd/class_form_other.html">FormOther</a>($db);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;$formfile = <span class="keyword">new</span> <a class="code" href="../../de/d23/class_form_file.html">FormFile</a>($db);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;$sqlusedforexport = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;$head = array();</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;$upload_dir = $conf-&gt;export-&gt;dir_temp.<span class="charliteral">&#39;/&#39;</span>.$user-&gt;id;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">//$usefilters=($conf-&gt;global-&gt;MAIN_FEATURES_LEVEL &gt; 1);</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;$usefilters = 1;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">// Security check</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;$result = <a class="code" href="../../dd/df3/security_8lib_8php.html#afd89914949e917d88361cf841a6f7d64">restrictedArea</a>($user, <span class="stringliteral">&#39;export&#39;</span>);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment"> * Actions</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="keywordflow">if</span> ($action == <span class="stringliteral">&#39;selectfield&#39;</span>) {     <span class="comment">// Selection of field at step 2</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    $fieldsarray = $objexport-&gt;array_export_fields[0];</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    $fieldsentitiesarray = $objexport-&gt;array_export_entities[0];</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    $fieldsdependenciesarray = $objexport-&gt;array_export_dependencies[0];</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span> ($field == <span class="stringliteral">&#39;all&#39;</span>) {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordflow">foreach</span> ($fieldsarray as $key =&gt; $val) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            <span class="keywordflow">if</span> (!empty($array_selected[$key])) {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                <span class="keywordflow">continue</span>; <span class="comment">// If already selected, check next</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            $array_selected[$key] = count($array_selected) + 1;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <span class="comment">//print_r($array_selected);</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            $_SESSION[<span class="stringliteral">&quot;export_selected_fields&quot;</span>] = $array_selected;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        $warnings = array();</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        $array_selected[$field] = count($array_selected) + 1; <span class="comment">// We tag the key $field as &quot;selected&quot;</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="comment">// We check if there is a dependency to activate</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="comment">/*var_dump($field);</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">        var_dump($fieldsentitiesarray[$field]);</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">        var_dump($fieldsdependenciesarray);*/</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        $listofdependencies = array();</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">if</span> (!empty($fieldsentitiesarray[$field]) &amp;&amp; !empty($fieldsdependenciesarray[$fieldsentitiesarray[$field]])) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="comment">// We found a dependency on the type of field</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            $tmp = $fieldsdependenciesarray[$fieldsentitiesarray[$field]]; <span class="comment">// $fieldsdependenciesarray=array(&#39;element&#39;=&gt;&#39;fd.rowid&#39;) or array(&#39;element&#39;=&gt;array(&#39;fd.rowid&#39;,&#39;ab.rowid&#39;))</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="keywordflow">if</span> (is_array($tmp)) {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                $listofdependencies = $tmp;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                $listofdependencies = array($tmp);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        } elseif (!empty($field) &amp;&amp; !empty($fieldsdependenciesarray[$field])) {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            <span class="comment">// We found a dependency on a dedicated field</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            $tmp = $fieldsdependenciesarray[$field]; <span class="comment">// $fieldsdependenciesarray=array(&#39;fd.fieldx&#39;=&gt;&#39;fd.rowid&#39;) or array(&#39;fd.fieldx&#39;=&gt;array(&#39;fd.rowid&#39;,&#39;ab.rowid&#39;))</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            <span class="keywordflow">if</span> (is_array($tmp)) {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                $listofdependencies = $tmp;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                $listofdependencies = array($tmp);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="keywordflow">if</span> (count($listofdependencies)) {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            <span class="keywordflow">foreach</span> ($listofdependencies as $fieldid) {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                <span class="keywordflow">if</span> (empty($array_selected[$fieldid])) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                    $array_selected[$fieldid] = count($array_selected) + 1; <span class="comment">// We tag the key $fieldid as &quot;selected&quot;</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                    $warnings[] = $langs-&gt;trans(<span class="stringliteral">&quot;ExportFieldAutomaticallyAdded&quot;</span>, $langs-&gt;transnoentitiesnoconv($fieldsarray[$fieldid]));</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="comment">//print_r($array_selected);</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        $_SESSION[<span class="stringliteral">&quot;export_selected_fields&quot;</span>] = $array_selected;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($warnings, <span class="keyword">null</span>, <span class="stringliteral">&#39;warnings&#39;</span>);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;}</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="keywordflow">if</span> ($action == <span class="stringliteral">&#39;unselectfield&#39;</span>) {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">if</span> ($_GET[<span class="stringliteral">&quot;field&quot;</span>] == <span class="stringliteral">&#39;all&#39;</span>) {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        $array_selected = array();</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        $_SESSION[<span class="stringliteral">&quot;export_selected_fields&quot;</span>] = $array_selected;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        unset($array_selected[$_GET[<span class="stringliteral">&quot;field&quot;</span>]]);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="comment">// Renumber fields of array_selected (from 1 to nb_elements)</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        asort($array_selected);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        $i = 0;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        $array_selected_save = $array_selected;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="keywordflow">foreach</span> ($array_selected as $code =&gt; $value) {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            $i++;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            $array_selected[$code] = $i;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <span class="comment">//print &quot;x $code x $i y&lt;br&gt;&quot;;</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        $_SESSION[<span class="stringliteral">&quot;export_selected_fields&quot;</span>] = $array_selected;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="keywordflow">if</span> ($action == <span class="stringliteral">&#39;downfield&#39;</span> || $action == <span class="stringliteral">&#39;upfield&#39;</span>) {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    $pos = $array_selected[$_GET[<span class="stringliteral">&quot;field&quot;</span>]];</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">if</span> ($action == <span class="stringliteral">&#39;downfield&#39;</span>) {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        $newpos = $pos + 1;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    }</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">if</span> ($action == <span class="stringliteral">&#39;upfield&#39;</span>) {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        $newpos = $pos - 1;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">// Recherche code avec qui switcher</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    $newcode = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">foreach</span> ($array_selected as $code =&gt; $value) {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="keywordflow">if</span> ($value == $newpos) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            $newcode = $code;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="comment">//print(&quot;Switch pos=$pos (code=&quot;.$_GET[&quot;field&quot;].&quot;) and newpos=$newpos (code=$newcode)&quot;);</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">if</span> ($newcode) {   <span class="comment">// Si newcode trouve (protection contre resoumission de page)</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        $array_selected[$_GET[<span class="stringliteral">&quot;field&quot;</span>]] = $newpos;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        $array_selected[$newcode] = $pos;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        $_SESSION[<span class="stringliteral">&quot;export_selected_fields&quot;</span>] = $array_selected;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;}</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="keywordflow">if</span> ($step == 1 || $action == <span class="stringliteral">&#39;cleanselect&#39;</span>) {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    $_SESSION[<span class="stringliteral">&quot;export_selected_fields&quot;</span>] = array();</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    $_SESSION[<span class="stringliteral">&quot;export_filtered_fields&quot;</span>] = array();</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    $array_selected = array();</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    $array_filtervalue = array();</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;}</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="keywordflow">if</span> ($action == <span class="stringliteral">&#39;builddoc&#39;</span>) {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    $max_execution_time_for_importexport = (empty($conf-&gt;global-&gt;EXPORT_MAX_EXECUTION_TIME) ? 300 : $conf-&gt;global-&gt;EXPORT_MAX_EXECUTION_TIME); <span class="comment">// 5mn if not defined</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    $max_time = @ini_get(<span class="stringliteral">&quot;max_execution_time&quot;</span>);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">if</span> ($max_time &amp;&amp; $max_time &lt; $max_execution_time_for_importexport) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;max_execution_time=&quot;</span>.$max_time.<span class="stringliteral">&quot; is lower than max_execution_time_for_importexport=&quot;</span>.$max_execution_time_for_importexport.<span class="stringliteral">&quot;. We try to increase it dynamically.&quot;</span>);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        @ini_set(<span class="stringliteral">&quot;max_execution_time&quot;</span>, $max_execution_time_for_importexport); <span class="comment">// This work only if safe mode is off. also web servers has timeout of 300</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="comment">// Build export file</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    $result = $objexport-&gt;build_file($user, <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;model&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>), $datatoexport, $array_selected, $array_filtervalue);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">if</span> ($result &lt; 0) {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($objexport-&gt;error, $objexport-&gt;errors, <span class="stringliteral">&#39;errors&#39;</span>);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        $sqlusedforexport = $objexport-&gt;sqlusedforexport;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($langs-&gt;trans(<span class="stringliteral">&quot;FileSuccessfullyBuilt&quot;</span>), <span class="keyword">null</span>, <span class="stringliteral">&#39;mesgs&#39;</span>);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        $sqlusedforexport = $objexport-&gt;sqlusedforexport;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;}</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">// Delete file</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="keywordflow">if</span> ($step == 5 &amp;&amp; $action == <span class="stringliteral">&#39;confirm_deletefile&#39;</span> &amp;&amp; $confirm == <span class="stringliteral">&#39;yes&#39;</span>) {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    $file = $upload_dir.<span class="stringliteral">&quot;/&quot;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;file&#39;</span>); <span class="comment">// Do not use urldecode here ($_GET and $_REQUEST are already decoded by PHP).</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    $ret = <a class="code" href="../../de/d28/files_8lib_8php.html#a6cc4b8b038c2bfcc52c8a744a120a9c2">dol_delete_file</a>($file);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">if</span> ($ret) {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($langs-&gt;trans(<span class="stringliteral">&quot;FileWasRemoved&quot;</span>, <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;file&#39;</span>)), <span class="keyword">null</span>, <span class="stringliteral">&#39;mesgs&#39;</span>);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($langs-&gt;trans(<span class="stringliteral">&quot;ErrorFailToDeleteFile&quot;</span>, <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;file&#39;</span>)), <span class="keyword">null</span>, <span class="stringliteral">&#39;errors&#39;</span>);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    }</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    header(<span class="stringliteral">&#39;Location: &#39;</span>.$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&#39;?step=&#39;</span>.$step.<span class="stringliteral">&#39;&amp;datatoexport=&#39;</span>.$datatoexport);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    exit;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="keywordflow">if</span> ($action == <span class="stringliteral">&#39;deleteprof&#39;</span>) {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&#39;int&#39;</span>)) {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        $objexport-&gt;fetch(<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>));</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        $result = $objexport-&gt;delete($user);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;}</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">// TODO The export for filter is not yet implemented (old code created conflicts with step 2). We must use same way of working and same combo list of predefined export than step 2.</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="keywordflow">if</span> ($action == <span class="stringliteral">&#39;add_export_model&#39;</span>) {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordflow">if</span> ($export_name) {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        asort($array_selected);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="comment">// Set save string</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        $hexa = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keywordflow">foreach</span> ($array_selected as $key =&gt; $val) {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            <span class="keywordflow">if</span> ($hexa) {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                $hexa .= <span class="charliteral">&#39;,&#39;</span>;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            $hexa .= $key;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        $hexafiltervalue = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordflow">if</span> (!empty($array_filtervalue) &amp;&amp; is_array($array_filtervalue)) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="keywordflow">foreach</span> ($array_filtervalue as $key =&gt; $val) {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                <span class="keywordflow">if</span> ($hexafiltervalue) {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                    $hexafiltervalue .= <span class="charliteral">&#39;,&#39;</span>;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                }</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                $hexafiltervalue .= $key.<span class="charliteral">&#39;=&#39;</span>.$val;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            }</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        }</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        $objexport-&gt;model_name = $export_name;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        $objexport-&gt;datatoexport = $datatoexport;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        $objexport-&gt;hexa = $hexa;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        $objexport-&gt;hexafiltervalue = $hexafiltervalue;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        $objexport-&gt;fk_user = (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;visibility&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>) == <span class="stringliteral">&#39;all&#39;</span> ? 0 : $user-&gt;id);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        $result = $objexport-&gt;create($user);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="keywordflow">if</span> ($result &gt;= 0) {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($langs-&gt;trans(<span class="stringliteral">&quot;ExportModelSaved&quot;</span>, $objexport-&gt;model_name), <span class="keyword">null</span>, <span class="stringliteral">&#39;mesgs&#39;</span>);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            $langs-&gt;load(<span class="stringliteral">&quot;errors&quot;</span>);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            <span class="keywordflow">if</span> ($objexport-&gt;errno == <span class="stringliteral">&#39;DB_ERROR_RECORD_ALREADY_EXISTS&#39;</span>) {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($langs-&gt;trans(<span class="stringliteral">&quot;ErrorExportDuplicateProfil&quot;</span>), <span class="keyword">null</span>, <span class="stringliteral">&#39;errors&#39;</span>);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($objexport-&gt;error, $objexport-&gt;errors, <span class="stringliteral">&#39;errors&#39;</span>);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        }</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($langs-&gt;trans(<span class="stringliteral">&quot;ErrorFieldRequired&quot;</span>, $langs-&gt;transnoentities(<span class="stringliteral">&quot;ExportModelName&quot;</span>)), <span class="keyword">null</span>, <span class="stringliteral">&#39;errors&#39;</span>);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    }</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;}</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">// Reload a predefined export model</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="keywordflow">if</span> ($step == 2 &amp;&amp; $action == <span class="stringliteral">&#39;select_model&#39;</span>) {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    $_SESSION[<span class="stringliteral">&quot;export_selected_fields&quot;</span>] = array();</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    $_SESSION[<span class="stringliteral">&quot;export_filtered_fields&quot;</span>] = array();</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    $array_selected = array();</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    $array_filtervalue = array();</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    $result = $objexport-&gt;fetch($exportmodelid);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">if</span> ($result &gt; 0) {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        $fieldsarray = preg_split(<span class="stringliteral">&quot;/,(?! [^(]*\))/&quot;</span>, $objexport-&gt;hexa);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        $i = 1;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordflow">foreach</span> ($fieldsarray as $val) {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            $array_selected[$val] = $i;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            $i++;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        }</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        $_SESSION[<span class="stringliteral">&quot;export_selected_fields&quot;</span>] = $array_selected;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        $fieldsarrayvalue = explode(<span class="charliteral">&#39;,&#39;</span>, $objexport-&gt;hexafiltervalue);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        $i = 1;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="keywordflow">foreach</span> ($fieldsarrayvalue as $val) {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            $tmp = explode(<span class="charliteral">&#39;=&#39;</span>, $val);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            $array_filtervalue[$tmp[0]] = $tmp[1];</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;            $i++;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        $_SESSION[<span class="stringliteral">&quot;export_filtered_fields&quot;</span>] = $array_filtervalue;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    }</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;}</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">// Get form with filters</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="keywordflow">if</span> ($step == 4 &amp;&amp; $action == <span class="stringliteral">&#39;submitFormField&#39;</span>) {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="comment">// on boucle sur les champs selectionne pour recuperer la valeur</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordflow">if</span> (is_array($objexport-&gt;array_export_TypeFields[0])) {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        $_SESSION[<span class="stringliteral">&quot;export_filtered_fields&quot;</span>] = array();</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">foreach</span> ($objexport-&gt;array_export_TypeFields[0] as $code =&gt; $type) {    <span class="comment">// $code: s.fieldname $value: Text|Boolean|List:ccc</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            $newcode = (string) preg_replace(<span class="stringliteral">&#39;/\./&#39;</span>, <span class="charliteral">&#39;_&#39;</span>, $code);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="comment">//print &#39;xxx&#39;.$code.&quot;=&quot;.$newcode.&quot;=&quot;.$type.&quot;=&quot;.$_POST[$newcode].&quot;\n&lt;br&gt;&quot;;</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            $filterqualified = 1;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a>($newcode) || <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>($newcode, <span class="stringliteral">&#39;restricthtml&#39;</span>) == <span class="stringliteral">&#39;&#39;</span>) {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                $filterqualified = 0;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            } elseif (preg_match(<span class="stringliteral">&#39;/^List/&#39;</span>, $type) &amp;&amp; (is_numeric(<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>($newcode, <span class="stringliteral">&#39;restricthtml&#39;</span>)) &amp;&amp; <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>($newcode, <span class="stringliteral">&#39;restricthtml&#39;</span>) &lt;= 0)) {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                $filterqualified = 0;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            }</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            <span class="keywordflow">if</span> ($filterqualified) {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                <span class="comment">//print &#39;Filter on &#39;.$newcode.&#39; type=&#39;.$type.&#39; value=&#39;.$_POST[$newcode].&quot;\n&quot;;</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                $objexport-&gt;array_export_FilterValue[0][$code] = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>($newcode, <span class="stringliteral">&#39;restricthtml&#39;</span>);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        $array_filtervalue = (!empty($objexport-&gt;array_export_FilterValue[0]) ? $objexport-&gt;array_export_FilterValue[0] : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        $_SESSION[<span class="stringliteral">&quot;export_filtered_fields&quot;</span>] = $array_filtervalue;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;}</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment"> * View</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="keywordflow">if</span> ($step == 1 || !$datatoexport) {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <a class="code" href="../../d6/d7c/asterisk_2wrapper_8php.html#abcab7df295b4869f8dfb1dd7059fd974">llxHeader</a>(<span class="stringliteral">&#39;&#39;</span>, $langs-&gt;trans(<span class="stringliteral">&quot;NewExport&quot;</span>), <span class="stringliteral">&#39;EN:Module_Exports_En|FR:Module_Exports|ES:M&amp;oacute;dulo_Exportaciones&#39;</span>);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    $h = 0;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    $head[$h][0] = DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=1&#39;</span>;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    $head[$h][1] = $langs-&gt;trans(<span class="stringliteral">&quot;Step&quot;</span>).<span class="stringliteral">&quot; 1&quot;</span>;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    $hselected = $h;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    $h++;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a171b010d7ac532414a9027d005f16f78">dol_get_fiche_head</a>($head, $hselected, <span class="stringliteral">&#39;&#39;</span>, -1);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;opacitymedium&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;SelectExportDataSet&quot;</span>).<span class="stringliteral">&#39;&lt;/div&gt;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="comment">// Affiche les modules d&#39;exports</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;div-table-responsive-no-min&quot;&gt;&#39;</span>; <span class="comment">// You can use div-table-responsive-no-min if you dont need reserved height for your table</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    print <span class="stringliteral">&#39;&lt;table class=&quot;noborder centpercent&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    print <span class="stringliteral">&#39;&lt;tr class=&quot;liste_titre&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Module&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ExportableDatas&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    print <span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">if</span> (count($objexport-&gt;array_export_module)) {</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        asort($objexport-&gt;array_export_code_for_sort);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="comment">//var_dump($objexport-&gt;array_export_code_for_sort);</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="comment">//$sortedarrayofmodules = dol_sort_array($objexport-&gt;array_export_module, &#39;module_position&#39;, &#39;asc&#39;, 0, 0, 1);</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordflow">foreach</span> ($objexport-&gt;array_export_code_for_sort as $key =&gt; $value) {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            print <span class="stringliteral">&#39;&lt;tr class=&quot;oddeven&quot;&gt;&lt;td nospan=&quot;nospan&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            <span class="comment">//print img_object($objexport-&gt;array_export_module[$key]-&gt;getName(),$export-&gt;array_export_module[$key]-&gt;picto).&#39; &#39;;</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            print $objexport-&gt;array_export_module[$key]-&gt;getName();</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            print <span class="stringliteral">&#39;&lt;/td&gt;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            $entity = preg_replace(<span class="stringliteral">&#39;/:.*$/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $objexport-&gt;array_export_icon[$key]);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            $entityicon = strtolower(!empty($entitytoicon[$entity]) ? $entitytoicon[$entity] : $entity);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            $label = $objexport-&gt;array_export_label[$key];</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            <span class="comment">//print $value.&#39;-&#39;.$icon.&#39;-&#39;.$label.&quot;&lt;br&gt;&quot;;</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a419171413de4ff6a584f2a3e5ad0408c">img_object</a>($objexport-&gt;array_export_module[$key]-&gt;getName(), $entityicon).<span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            print $label;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            print <span class="stringliteral">&#39;&lt;/td&gt;&lt;td class=&quot;right&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            <span class="keywordflow">if</span> ($objexport-&gt;array_export_perms[$key]) {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                print <span class="stringliteral">&#39;&lt;a href=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=2&amp;module_position=&#39;</span>.$objexport-&gt;array_export_module[$key]-&gt;module_position.<span class="stringliteral">&#39;&amp;datatoexport=&#39;</span>.$objexport-&gt;array_export_code[$key].<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a64fc44ee4f3329fe0ff256b57bffc128">img_picto</a>($langs-&gt;trans(<span class="stringliteral">&quot;NewExport&quot;</span>), <span class="stringliteral">&#39;next&#39;</span>, <span class="stringliteral">&#39;class=&quot;fa-15x&quot;&#39;</span>).<span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                print <span class="stringliteral">&#39;&lt;span class=&quot;opacitymedium&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;NotEnoughPermissions&quot;</span>).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            }</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            print <span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        }</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td class=&quot;oddeven&quot; colspan=&quot;3&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;NoExportableData&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    print <span class="stringliteral">&#39;&lt;/table&gt;&#39;</span>;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160; </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;}</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160; </div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="keywordflow">if</span> ($step == 2 &amp;&amp; $datatoexport) {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <a class="code" href="../../d6/d7c/asterisk_2wrapper_8php.html#abcab7df295b4869f8dfb1dd7059fd974">llxHeader</a>(<span class="stringliteral">&#39;&#39;</span>, $langs-&gt;trans(<span class="stringliteral">&quot;NewExport&quot;</span>), <span class="stringliteral">&#39;EN:Module_Exports_En|FR:Module_Exports|ES:M&amp;oacute;dulo_Exportaciones&#39;</span>);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160; </div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    $h = 0;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    $head[$h][0] = DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=1&#39;</span>;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    $head[$h][1] = $langs-&gt;trans(<span class="stringliteral">&quot;Step&quot;</span>).<span class="stringliteral">&quot; 1&quot;</span>;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    $h++;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    $head[$h][0] = DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=2&amp;datatoexport=&#39;</span>.$datatoexport;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    $head[$h][1] = $langs-&gt;trans(<span class="stringliteral">&quot;Step&quot;</span>).<span class="stringliteral">&quot; 2&quot;</span>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    $hselected = $h;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    $h++;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; </div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a171b010d7ac532414a9027d005f16f78">dol_get_fiche_head</a>($head, $hselected, <span class="stringliteral">&#39;&#39;</span>, -2);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;fichecenter&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;underbanner clearboth&quot;&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    print <span class="stringliteral">&#39;&lt;table width=&quot;100%&quot; class=&quot;border tableforfield&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="comment">// Module</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td class=&quot;titlefield&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Module&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    print $objexport-&gt;array_export_module[0]-&gt;getName();</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    print <span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160; </div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="comment">// Lot de donnees a exporter</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;DatasetToExport&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    $entity = preg_replace(<span class="stringliteral">&#39;/:.*$/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $objexport-&gt;array_export_icon[0]);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    $entityicon = strtolower(!empty($entitytoicon[$entity]) ? $entitytoicon[$entity] : $entity);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a419171413de4ff6a584f2a3e5ad0408c">img_object</a>($objexport-&gt;array_export_module[0]-&gt;getName(), $entityicon).<span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    print $objexport-&gt;array_export_label[0];</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    print <span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160; </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    print <span class="stringliteral">&#39;&lt;/table&gt;&#39;</span>;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a43ed6679bd4b390f7b120bf848d5acf9">dol_get_fiche_end</a>();</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    print <span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="comment">// Combo list of export models</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    print <span class="stringliteral">&#39;&lt;form action=&quot;&#39;</span>.$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&#39;&quot; method=&quot;post&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;&#39;</span>.newToken().<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;action&quot; value=&quot;select_model&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;step&quot; value=&quot;2&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;datatoexport&quot; value=&quot;&#39;</span>.$datatoexport.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;valignmiddle marginbottomonly&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    print <span class="stringliteral">&#39;&lt;span class=&quot;opacitymedium&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;SelectExportFields&quot;</span>).<span class="stringliteral">&#39;&lt;/span&gt; &#39;</span>;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    $htmlother-&gt;select_export_model($exportmodelid, <span class="stringliteral">&#39;exportmodelid&#39;</span>, $datatoexport, 1, $user-&gt;id);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    print <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    print <span class="stringliteral">&#39;&lt;input type=&quot;submit&quot; class=&quot;button&quot; value=&quot;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Select&quot;</span>).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    print <span class="stringliteral">&#39;&lt;/form&gt;&#39;</span>;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;div-table-responsive-no-min&quot;&gt;&#39;</span>; <span class="comment">// You can use div-table-responsive-no-min if you dont need reserved height for your table</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    print <span class="stringliteral">&#39;&lt;table class=&quot;noborder centpercent&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    print <span class="stringliteral">&#39;&lt;tr class=&quot;liste_titre&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Entities&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ExportableFields&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    print <span class="stringliteral">&#39;&lt;td width=&quot;100&quot; class=&quot;center&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    print <span class="stringliteral">&#39;&lt;a class=&quot;liste_titre commonlink&quot; title=&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;All&quot;</span>).<span class="stringliteral">&#39; alt=&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;All&quot;</span>).<span class="stringliteral">&#39; href=&quot;&#39;</span>.$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&#39;?step=2&amp;datatoexport=&#39;</span>.$datatoexport.<span class="stringliteral">&#39;&amp;action=selectfield&amp;field=all&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;All&quot;</span>).<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    print <span class="stringliteral">&#39; / &#39;</span>;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    print <span class="stringliteral">&#39;&lt;a class=&quot;liste_titre commonlink&quot; title=&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;None&quot;</span>).<span class="stringliteral">&#39; alt=&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;None&quot;</span>).<span class="stringliteral">&#39; href=&quot;&#39;</span>.$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&#39;?step=2&amp;datatoexport=&#39;</span>.$datatoexport.<span class="stringliteral">&#39;&amp;action=unselectfield&amp;field=all&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;None&quot;</span>).<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    print <span class="stringliteral">&#39;&lt;td width=&quot;44%&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ExportedFields&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    print <span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="comment">// Champs exportables</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    $fieldsarray = $objexport-&gt;array_export_fields[0];</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="comment">// Select request if all fields are selected</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    $sqlmaxforexport = $objexport-&gt;build_sql(0, array(), array());</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160; </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="comment">//    $this-&gt;array_export_module[0]=$module;</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="comment">//    $this-&gt;array_export_code[0]=$module-&gt;export_code[$r];</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">//    $this-&gt;array_export_label[0]=$module-&gt;export_label[$r];</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="comment">//    $this-&gt;array_export_sql[0]=$module-&gt;export_sql[$r];</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="comment">//    $this-&gt;array_export_fields[0]=$module-&gt;export_fields_array[$r];</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="comment">//    $this-&gt;array_export_entities[0]=$module-&gt;export_fields_entities[$r];</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="comment">//    $this-&gt;array_export_alias[0]=$module-&gt;export_fields_alias[$r];</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    $i = 0;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordflow">foreach</span> ($fieldsarray as $code =&gt; $label) {</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        print <span class="stringliteral">&#39;&lt;tr class=&quot;oddeven&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        $i++;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160; </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        $entity = (!empty($objexport-&gt;array_export_entities[0][$code]) ? $objexport-&gt;array_export_entities[0][$code] : $objexport-&gt;array_export_icon[0]);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        $entityicon = strtolower(!empty($entitytoicon[$entity]) ? $entitytoicon[$entity] : $entity);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        $entitylang = (!empty($entitytolang[$entity]) ? $entitytolang[$entity] : $entity);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        print <span class="stringliteral">&#39;&lt;td class=&quot;nowrap&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="comment">// If value of entityicon=entitylang=&#39;icon:Label&#39;</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="comment">//print $code.&#39;-&#39;.$label.&#39;-&#39;.$entity;</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        $tmparray = explode(<span class="charliteral">&#39;:&#39;</span>, $entityicon);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="keywordflow">if</span> (count($tmparray) &gt;= 2) {</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            $entityicon = $tmparray[0];</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            $entitylang = $tmparray[1];</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        }</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a419171413de4ff6a584f2a3e5ad0408c">img_object</a>(<span class="stringliteral">&#39;&#39;</span>, $entityicon).<span class="charliteral">&#39; &#39;</span>.$langs-&gt;trans($entitylang);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        $text = (empty($objexport-&gt;array_export_special[0][$code]) ? <span class="stringliteral">&#39;&#39;</span> : <span class="stringliteral">&#39;&lt;i&gt;&#39;</span>).$langs-&gt;trans($label).(empty($objexport-&gt;array_export_special[0][$code]) ? <span class="stringliteral">&#39;&#39;</span> : <span class="stringliteral">&#39;&lt;/i&gt;&#39;</span>);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160; </div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        $tablename = <a class="code" href="../../d2/db0/exports_2export_8php.html#a65f277b3c1bbf9bac086a95503df067a">getablenamefromfield</a>($code, $sqlmaxforexport);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        $htmltext = <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Name&quot;</span>).<span class="stringliteral">&quot;:&lt;/b&gt; &quot;</span>.$text.<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">if</span> (!empty($objexport-&gt;array_export_special[0][$code])) {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            $htmltext .= <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ComputedField&quot;</span>).<span class="stringliteral">&quot; -&gt; &quot;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Method&quot;</span>).<span class="stringliteral">&quot; :&lt;/b&gt; &quot;</span>.$objexport-&gt;array_export_special[0][$code].<span class="stringliteral">&quot;&lt;br&gt;&quot;</span>;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            $htmltext .= <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Table&quot;</span>).<span class="stringliteral">&quot; -&gt; &quot;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Field&quot;</span>).<span class="stringliteral">&quot;:&lt;/b&gt; &quot;</span>.$tablename.<span class="stringliteral">&quot; -&gt; &quot;</span>.preg_replace(<span class="stringliteral">&#39;/^.*\./&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $code).<span class="stringliteral">&quot;&lt;br&gt;&quot;</span>;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        }</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="keywordflow">if</span> (!empty($objexport-&gt;array_export_examplevalues[0][$code])) {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            $htmltext .= <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;SourceExample&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$objexport-&gt;array_export_examplevalues[0][$code].<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <span class="keywordflow">if</span> (!empty($objexport-&gt;array_export_TypeFields[0][$code])) {</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            $htmltext .= <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Type&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$objexport-&gt;array_export_TypeFields[0][$code].<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="keywordflow">if</span> (!empty($objexport-&gt;array_export_help[0][$code])) {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            $htmltext .= <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Help&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$langs-&gt;trans($objexport-&gt;array_export_help[0][$code]).<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">if</span> (isset($array_selected[$code]) &amp;&amp; $array_selected[$code]) {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            <span class="comment">// Selected fields</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            print <span class="stringliteral">&#39;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            print <span class="stringliteral">&#39;&lt;td class=&quot;center&quot;&gt;&lt;a class=&quot;reposition&quot; href=&quot;&#39;</span>.$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&#39;?step=2&amp;datatoexport=&#39;</span>.$datatoexport.<span class="stringliteral">&#39;&amp;action=unselectfield&amp;field=&#39;</span>.$code.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a1bddcdff388341b5a9b49308fb402abd">img_left</a>(<span class="stringliteral">&#39;default&#39;</span>, 0, <span class="stringliteral">&#39;style=&quot;max-width: 20px&quot;&#39;</span>).<span class="stringliteral">&#39;&lt;/a&gt;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <span class="comment">//print $text.&#39;-&#39;.$htmltext.&quot;&lt;br&gt;&quot;;</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            print $form-&gt;textwithpicto($text, $htmltext);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <span class="comment">//print &#39; (&#39;.$code.&#39;)&#39;;</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            <span class="comment">// Fields not selected</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            <span class="comment">//print $text.&#39;-&#39;.$htmltext.&quot;&lt;br&gt;&quot;;</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            print $form-&gt;textwithpicto($text, $htmltext);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            <span class="comment">//print &#39; (&#39;.$code.&#39;)&#39;;</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            print <span class="stringliteral">&#39;&lt;td class=&quot;center&quot;&gt;&lt;a class=&quot;reposition&quot; href=&quot;&#39;</span>.$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&#39;?step=2&amp;datatoexport=&#39;</span>.$datatoexport.<span class="stringliteral">&#39;&amp;action=selectfield&amp;field=&#39;</span>.$code.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a15ee713320bf5a7b4ea2a8d9401787c6">img_right</a>(<span class="stringliteral">&#39;default&#39;</span>, 0, <span class="stringliteral">&#39;style=&quot;max-width: 20px&quot;&#39;</span>).<span class="stringliteral">&#39;&lt;/a&gt;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            print <span class="stringliteral">&#39;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        print <span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    print <span class="stringliteral">&#39;&lt;/table&gt;&#39;</span>;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">     * Action bar</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;tabsAction tabsActionNoBottom&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordflow">if</span> (count($array_selected)) {</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <span class="comment">// If filters exist</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="keywordflow">if</span> ($usefilters &amp;&amp; isset($objexport-&gt;array_export_TypeFields[0]) &amp;&amp; is_array($objexport-&gt;array_export_TypeFields[0])) {</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            print <span class="stringliteral">&#39;&lt;a class=&quot;butAction&quot; href=&quot;export.php?step=3&amp;datatoexport=&#39;</span>.$datatoexport.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;NextStep&quot;</span>).<span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            print <span class="stringliteral">&#39;&lt;a class=&quot;butAction&quot; href=&quot;export.php?step=4&amp;datatoexport=&#39;</span>.$datatoexport.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;NextStep&quot;</span>).<span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        print <span class="stringliteral">&#39;&lt;a class=&quot;butActionRefused classfortooltip&quot; href=&quot;#&quot; title=&quot;&#39;</span>.dol_escape_htmltag($langs-&gt;trans(<span class="stringliteral">&quot;SelectAtLeastOneField&quot;</span>)).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;NextStep&quot;</span>).<span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    }</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;}</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="keywordflow">if</span> ($step == 3 &amp;&amp; $datatoexport) {</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordflow">if</span> (count($array_selected) &lt; 1) {      <span class="comment">// This occurs when going back to page after sessecion expired</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="comment">// Switch to step 2</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        header(<span class="stringliteral">&quot;Location: &quot;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=2&amp;datatoexport=&#39;</span>.$datatoexport);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        exit;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    }</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160; </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <a class="code" href="../../d6/d7c/asterisk_2wrapper_8php.html#abcab7df295b4869f8dfb1dd7059fd974">llxHeader</a>(<span class="stringliteral">&#39;&#39;</span>, $langs-&gt;trans(<span class="stringliteral">&quot;NewExport&quot;</span>), <span class="stringliteral">&#39;EN:Module_Exports_En|FR:Module_Exports|ES:M&amp;oacute;dulo_Exportaciones&#39;</span>);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160; </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    $h = 0;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    $head[$h][0] = DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=1&#39;</span>;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    $head[$h][1] = $langs-&gt;trans(<span class="stringliteral">&quot;Step&quot;</span>).<span class="stringliteral">&quot; 1&quot;</span>;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    $h++;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    $head[$h][0] = DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=2&amp;datatoexport=&#39;</span>.$datatoexport;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    $head[$h][1] = $langs-&gt;trans(<span class="stringliteral">&quot;Step&quot;</span>).<span class="stringliteral">&quot; 2&quot;</span>;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    $h++;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160; </div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    $head[$h][0] = DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=3&amp;datatoexport=&#39;</span>.$datatoexport;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    $head[$h][1] = $langs-&gt;trans(<span class="stringliteral">&quot;Step&quot;</span>).<span class="stringliteral">&quot; 3&quot;</span>;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    $hselected = $h;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    $h++;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160; </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a171b010d7ac532414a9027d005f16f78">dol_get_fiche_head</a>($head, $hselected, <span class="stringliteral">&#39;&#39;</span>, -2);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;fichecenter&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;underbanner clearboth&quot;&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    print <span class="stringliteral">&#39;&lt;table width=&quot;100%&quot; class=&quot;border tableforfield&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="comment">// Module</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td class=&quot;titlefield&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Module&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="comment">//print img_object($objexport-&gt;array_export_module[0]-&gt;getName(),$objexport-&gt;array_export_module[0]-&gt;picto).&#39; &#39;;</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    print $objexport-&gt;array_export_module[0]-&gt;getName();</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    print <span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="comment">// Lot de donnees a exporter</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;DatasetToExport&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    $entity = preg_replace(<span class="stringliteral">&#39;/:.*$/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $objexport-&gt;array_export_icon[0]);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    $entityicon = strtolower(!empty($entitytoicon[$entity]) ? $entitytoicon[$entity] : $entity);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a419171413de4ff6a584f2a3e5ad0408c">img_object</a>($objexport-&gt;array_export_module[0]-&gt;getName(), $entityicon).<span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    print $objexport-&gt;array_export_label[0];</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    print <span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; </div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="comment">// Nbre champs exportes</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ExportedFields&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    $list = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="keywordflow">foreach</span> ($array_selected as $code =&gt; $value) {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        $list .= (!empty($list) ? <span class="stringliteral">&#39;, &#39;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        $list .= (isset($objexport-&gt;array_export_fields[0][$code]) ? $langs-&gt;trans($objexport-&gt;array_export_fields[0][$code]) : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    }</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$list.<span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    print <span class="stringliteral">&#39;&lt;/table&gt;&#39;</span>;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160; </div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    print <span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160; </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="comment">// Combo list of export models</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    print <span class="stringliteral">&#39;&lt;span class=&quot;opacitymedium&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;SelectFilterFields&quot;</span>).<span class="stringliteral">&#39;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160; </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="comment">// un formulaire en plus pour recuperer les filtres</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    print <span class="stringliteral">&#39;&lt;form action=&quot;&#39;</span>.$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&#39;?step=4&amp;action=submitFormField&amp;datatoexport=&#39;</span>.$datatoexport.<span class="stringliteral">&#39;&quot; name=&quot;FilterField&quot; method=&quot;post&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;&#39;</span>.newToken().<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160; </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;div-table-responsive-no-min&quot;&gt;&#39;</span>; <span class="comment">// You can use div-table-responsive-no-min if you dont need reserved height for your table</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; </div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    print <span class="stringliteral">&#39;&lt;table class=&quot;noborder centpercent&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    print <span class="stringliteral">&#39;&lt;tr class=&quot;liste_titre&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Entities&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="comment">//print &#39;&lt;td&gt;&#39;.$langs-&gt;trans(&quot;ExportableFields&quot;).&#39;&lt;/td&gt;&#39;;</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="comment">//print &#39;&lt;td class=&quot;center&quot;&gt;&lt;/td&gt;&#39;;</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ExportableFields&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    print <span class="stringliteral">&#39;&lt;td width=&quot;25%&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;FilteredFieldsValues&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    print <span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160; </div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="comment">// Champs exportables</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    $fieldsarray = $objexport-&gt;array_export_fields[0];</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="comment">// Champs filtrable</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    $Typefieldsarray = $objexport-&gt;array_export_TypeFields[0];</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="comment">// valeur des filtres</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    $ValueFiltersarray = (!empty($objexport-&gt;array_export_FilterValue[0]) ? $objexport-&gt;array_export_FilterValue[0] : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="comment">// Select request if all fields are selected</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    $sqlmaxforexport = $objexport-&gt;build_sql(0, array(), array());</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    $i = 0;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="comment">// on boucle sur les champs</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">foreach</span> ($fieldsarray as $code =&gt; $label) {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        print <span class="stringliteral">&#39;&lt;tr class=&quot;oddeven&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160; </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        $i++;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        $entity = (!empty($objexport-&gt;array_export_entities[0][$code]) ? $objexport-&gt;array_export_entities[0][$code] : $objexport-&gt;array_export_icon[0]);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        $entityicon = strtolower(!empty($entitytoicon[$entity]) ? $entitytoicon[$entity] : $entity);</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        $entitylang = (!empty($entitytolang[$entity]) ? $entitytolang[$entity] : $entity);</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160; </div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        print <span class="stringliteral">&#39;&lt;td class=&quot;nowrap&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="comment">// If value of entityicon=entitylang=&#39;icon:Label&#39;</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        $tmparray = explode(<span class="charliteral">&#39;:&#39;</span>, $entityicon);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <span class="keywordflow">if</span> (count($tmparray) &gt;= 2) {</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            $entityicon = $tmparray[0];</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            $entitylang = $tmparray[1];</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a419171413de4ff6a584f2a3e5ad0408c">img_object</a>(<span class="stringliteral">&#39;&#39;</span>, $entityicon).<span class="charliteral">&#39; &#39;</span>.$langs-&gt;trans($entitylang);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160; </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="comment">// Field name</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        $labelName = (!empty($fieldsarray[$code]) ? $fieldsarray[$code] : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        $ValueFilter = (!empty($array_filtervalue[$code]) ? $array_filtervalue[$code] : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        $text = (empty($objexport-&gt;array_export_special[0][$code]) ? <span class="stringliteral">&#39;&#39;</span> : <span class="stringliteral">&#39;&lt;i&gt;&#39;</span>).$langs-&gt;trans($labelName).(empty($objexport-&gt;array_export_special[0][$code]) ? <span class="stringliteral">&#39;&#39;</span> : <span class="stringliteral">&#39;&lt;/i&gt;&#39;</span>);</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160; </div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        $tablename = <a class="code" href="../../d2/db0/exports_2export_8php.html#a65f277b3c1bbf9bac086a95503df067a">getablenamefromfield</a>($code, $sqlmaxforexport);</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        $htmltext = <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Name&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$text.<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        <span class="keywordflow">if</span> (!empty($objexport-&gt;array_export_special[0][$code])) {</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            $htmltext .= <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ComputedField&quot;</span>).<span class="stringliteral">&quot; -&gt; &quot;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Method&quot;</span>).<span class="stringliteral">&quot; :&lt;/b&gt; &quot;</span>.$objexport-&gt;array_export_special[0][$code].<span class="stringliteral">&quot;&lt;br&gt;&quot;</span>;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            $htmltext .= <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Table&quot;</span>).<span class="stringliteral">&quot; -&gt; &quot;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Field&quot;</span>).<span class="stringliteral">&quot;:&lt;/b&gt; &quot;</span>.$tablename.<span class="stringliteral">&quot; -&gt; &quot;</span>.preg_replace(<span class="stringliteral">&#39;/^.*\./&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $code).<span class="stringliteral">&quot;&lt;br&gt;&quot;</span>;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        }</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <span class="keywordflow">if</span> (!empty($objexport-&gt;array_export_examplevalues[0][$code])) {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            $htmltext .= <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;SourceExample&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$objexport-&gt;array_export_examplevalues[0][$code].<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        }</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        <span class="keywordflow">if</span> (!empty($objexport-&gt;array_export_TypeFields[0][$code])) {</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            $htmltext .= <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Type&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$objexport-&gt;array_export_TypeFields[0][$code].<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        }</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="keywordflow">if</span> (!empty($objexport-&gt;array_export_help[0][$code])) {</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            $htmltext .= <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Help&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$langs-&gt;trans($objexport-&gt;array_export_help[0][$code]).<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        }</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160; </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        print $form-&gt;textwithpicto($text, $htmltext);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160; </div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <span class="comment">// Filter value</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="keywordflow">if</span> (!empty($Typefieldsarray[$code])) {  <span class="comment">// Example: Text, List:c_country:label:rowid, Number, Boolean</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            $szInfoFiltre = $objexport-&gt;genDocFilter($Typefieldsarray[$code]);</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            <span class="keywordflow">if</span> ($szInfoFiltre) {    <span class="comment">// Is there an info help for this filter ?</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                $tmp = $objexport-&gt;build_filterField($Typefieldsarray[$code], $code, $ValueFilter);</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                print $form-&gt;textwithpicto($tmp, $szInfoFiltre);</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                print $objexport-&gt;build_filterField($Typefieldsarray[$code], $code, $ValueFilter);</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            }</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160; </div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        print <span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    }</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160; </div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    print <span class="stringliteral">&#39;&lt;/table&gt;&#39;</span>;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160; </div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160; </div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment">     * Action bar</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;tabsAction tabsActionNoBottom&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="comment">// il n&#39;est pas obligatoire de filtrer les champs</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    print <span class="stringliteral">&#39;&lt;a class=&quot;butAction&quot; href=&quot;javascript:FilterField.submit();&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;NextStep&quot;</span>).<span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;}</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160; </div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="keywordflow">if</span> ($step == 4 &amp;&amp; $datatoexport) {</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keywordflow">if</span> (count($array_selected) &lt; 1) {     <span class="comment">// This occurs when going back to page after sessecion expired</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <span class="comment">// Switch to step 2</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        header(<span class="stringliteral">&quot;Location: &quot;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=2&amp;datatoexport=&#39;</span>.$datatoexport);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        exit;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    }</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160; </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    asort($array_selected);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160; </div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <a class="code" href="../../d6/d7c/asterisk_2wrapper_8php.html#abcab7df295b4869f8dfb1dd7059fd974">llxHeader</a>(<span class="stringliteral">&#39;&#39;</span>, $langs-&gt;trans(<span class="stringliteral">&quot;NewExport&quot;</span>), <span class="stringliteral">&#39;EN:Module_Exports_En|FR:Module_Exports|ES:M&amp;oacute;dulo_Exportaciones&#39;</span>);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160; </div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    $stepoffset = 0;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    $h = 0;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160; </div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    $head[$h][0] = DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=1&#39;</span>;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    $head[$h][1] = $langs-&gt;trans(<span class="stringliteral">&quot;Step&quot;</span>).<span class="stringliteral">&quot; 1&quot;</span>;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    $h++;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160; </div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    $head[$h][0] = DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=2&amp;datatoexport=&#39;</span>.$datatoexport;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    $head[$h][1] = $langs-&gt;trans(<span class="stringliteral">&quot;Step&quot;</span>).<span class="stringliteral">&quot; 2&quot;</span>;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    $h++;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160; </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="comment">// If filters exist</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordflow">if</span> ($usefilters &amp;&amp; isset($objexport-&gt;array_export_TypeFields[0]) &amp;&amp; is_array($objexport-&gt;array_export_TypeFields[0])) {</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        $head[$h][0] = DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=3&amp;datatoexport=&#39;</span>.$datatoexport;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        $head[$h][1] = $langs-&gt;trans(<span class="stringliteral">&quot;Step&quot;</span>).<span class="stringliteral">&quot; 3&quot;</span>;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        $h++;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        $stepoffset++;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    }</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160; </div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    $head[$h][0] = DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=4&amp;datatoexport=&#39;</span>.$datatoexport;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    $head[$h][1] = $langs-&gt;trans(<span class="stringliteral">&quot;Step&quot;</span>).<span class="stringliteral">&quot; &quot;</span>.(3 + $stepoffset);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    $hselected = $h;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    $h++;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160; </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a171b010d7ac532414a9027d005f16f78">dol_get_fiche_head</a>($head, $hselected, <span class="stringliteral">&#39;&#39;</span>, -2);</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160; </div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;fichecenter&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;underbanner clearboth&quot;&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    print <span class="stringliteral">&#39;&lt;table width=&quot;100%&quot; class=&quot;border tableforfield&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160; </div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="comment">// Module</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td class=&quot;titlefield tableforfield&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Module&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="comment">//print img_object($objexport-&gt;array_export_module[0]-&gt;getName(),$objexport-&gt;array_export_module[0]-&gt;picto).&#39; &#39;;</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    print $objexport-&gt;array_export_module[0]-&gt;getName();</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    print <span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="comment">// Lot de donnees a exporter</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;DatasetToExport&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    $entity = preg_replace(<span class="stringliteral">&#39;/:.*$/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $objexport-&gt;array_export_icon[0]);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    $entityicon = strtolower(!empty($entitytoicon[$entity]) ? $entitytoicon[$entity] : $entity);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a419171413de4ff6a584f2a3e5ad0408c">img_object</a>($objexport-&gt;array_export_module[0]-&gt;getName(), $entityicon).<span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    print $objexport-&gt;array_export_label[0];</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    print <span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160; </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="comment">// List of exported fields</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ExportedFields&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    $list = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">foreach</span> ($array_selected as $code =&gt; $value) {</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        $list .= (!empty($list) ? <span class="stringliteral">&#39;, &#39;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        $list .= $langs-&gt;trans($objexport-&gt;array_export_fields[0][$code]);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    }</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$list.<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    print <span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="comment">// List of filtered fiels</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="keywordflow">if</span> (isset($objexport-&gt;array_export_TypeFields[0]) &amp;&amp; is_array($objexport-&gt;array_export_TypeFields[0])) {</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;FilteredFields&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        $list = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <span class="keywordflow">if</span> (!empty($array_filtervalue)) {</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            <span class="keywordflow">foreach</span> ($array_filtervalue as $code =&gt; $value) {</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                <span class="keywordflow">if</span> (isset($objexport-&gt;array_export_fields[0][$code])) {</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                    $list .= ($list ? <span class="stringliteral">&#39;, &#39;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                    <span class="keywordflow">if</span> (isset($array_filtervalue[$code]) &amp;&amp; preg_match(<span class="stringliteral">&#39;/^\s*[&lt;&gt;]/&#39;</span>, $array_filtervalue[$code])) {</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                        $list .= $langs-&gt;trans($objexport-&gt;array_export_fields[0][$code]).(isset($array_filtervalue[$code]) ? $array_filtervalue[$code] : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                        $list .= $langs-&gt;trans($objexport-&gt;array_export_fields[0][$code]).<span class="stringliteral">&quot;=&#39;&quot;</span>.(isset($array_filtervalue[$code]) ? $array_filtervalue[$code] : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&quot;&#39;&quot;</span>;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                    }</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            }</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.(!empty($list) ? $list : <span class="stringliteral">&#39;&lt;span class=&quot;opacitymedium&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;None&quot;</span>).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        print <span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160; </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    print <span class="stringliteral">&#39;&lt;/table&gt;&#39;</span>;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    print <span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160; </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="comment">// Select request if all fields are selected</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    $sqlmaxforexport = $objexport-&gt;build_sql(0, array(), array());</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160; </div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;marginbottomonly&quot;&gt;&lt;span class=&quot;opacitymedium&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ChooseFieldsOrdersAndTitle&quot;</span>).<span class="stringliteral">&#39;&lt;/span&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160; </div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;div-table-responsive-no-min&quot;&gt;&#39;</span>; <span class="comment">// You can use div-table-responsive-no-min if you dont need reserved height for your table</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    print <span class="stringliteral">&#39;&lt;table class=&quot;noborder centpercent&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    print <span class="stringliteral">&#39;&lt;tr class=&quot;liste_titre&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Entities&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ExportedFields&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    print <span class="stringliteral">&#39;&lt;td class=&quot;right&quot; colspan=&quot;2&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Position&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="comment">//print &#39;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&#39;;</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="comment">//print &#39;&lt;td&gt;&#39;.$langs-&gt;trans(&quot;FieldsTitle&quot;).&#39;&lt;/td&gt;&#39;;</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    print <span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160; </div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="keywordflow">foreach</span> ($array_selected as $code =&gt; $value) {</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        print <span class="stringliteral">&#39;&lt;tr class=&quot;oddeven&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160; </div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        $entity = (!empty($objexport-&gt;array_export_entities[0][$code]) ? $objexport-&gt;array_export_entities[0][$code] : $objexport-&gt;array_export_icon[0]);</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        $entityicon = strtolower(!empty($entitytoicon[$entity]) ? $entitytoicon[$entity] : $entity);</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        $entitylang = (!empty($entitytolang[$entity]) ? $entitytolang[$entity] : $entity);</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160; </div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        print <span class="stringliteral">&#39;&lt;td class=&quot;nowrap&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="comment">// If value of entityicon=entitylang=&#39;icon:Label&#39;</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        $tmparray = explode(<span class="charliteral">&#39;:&#39;</span>, $entityicon);</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        <span class="keywordflow">if</span> (count($tmparray) &gt;= 2) {</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;            $entityicon = $tmparray[0];</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            $entitylang = $tmparray[1];</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        }</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a419171413de4ff6a584f2a3e5ad0408c">img_object</a>(<span class="stringliteral">&#39;&#39;</span>, $entityicon).<span class="charliteral">&#39; &#39;</span>.$langs-&gt;trans($entitylang);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160; </div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        $labelName = $objexport-&gt;array_export_fields[0][$code];</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160; </div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        $text = (empty($objexport-&gt;array_export_special[0][$code]) ? <span class="stringliteral">&#39;&#39;</span> : <span class="stringliteral">&#39;&lt;i&gt;&#39;</span>).$langs-&gt;trans($labelName).(empty($objexport-&gt;array_export_special[0][$code]) ? <span class="stringliteral">&#39;&#39;</span> : <span class="stringliteral">&#39;&lt;/i&gt;&#39;</span>);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160; </div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        $tablename = <a class="code" href="../../d2/db0/exports_2export_8php.html#a65f277b3c1bbf9bac086a95503df067a">getablenamefromfield</a>($code, $sqlmaxforexport);</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        $htmltext = <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Name&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$text.<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <span class="keywordflow">if</span> (!empty($objexport-&gt;array_export_special[0][$code])) {</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;            $htmltext .= <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ComputedField&quot;</span>).<span class="stringliteral">&quot; -&gt; &quot;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Method&quot;</span>).<span class="stringliteral">&quot; :&lt;/b&gt; &quot;</span>.$objexport-&gt;array_export_special[0][$code].<span class="stringliteral">&quot;&lt;br&gt;&quot;</span>;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            $htmltext .= <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Table&quot;</span>).<span class="stringliteral">&quot; -&gt; &quot;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Field&quot;</span>).<span class="stringliteral">&quot;:&lt;/b&gt; &quot;</span>.$tablename.<span class="stringliteral">&quot; -&gt; &quot;</span>.preg_replace(<span class="stringliteral">&#39;/^.*\./&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $code).<span class="stringliteral">&quot;&lt;br&gt;&quot;</span>;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        <span class="keywordflow">if</span> (!empty($objexport-&gt;array_export_examplevalues[0][$code])) {</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            $htmltext .= <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;SourceExample&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$objexport-&gt;array_export_examplevalues[0][$code].<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        }</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        <span class="keywordflow">if</span> (!empty($objexport-&gt;array_export_TypeFields[0][$code])) {</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            $htmltext .= <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Type&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$objexport-&gt;array_export_TypeFields[0][$code].<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        }</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        <span class="keywordflow">if</span> (!empty($objexport-&gt;array_export_help[0][$code])) {</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            $htmltext .= <span class="stringliteral">&#39;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Help&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$langs-&gt;trans($objexport-&gt;array_export_help[0][$code]).<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        }</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        print $form-&gt;textwithpicto($text, $htmltext);</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <span class="comment">//print &#39; (&#39;.$code.&#39;)&#39;;</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160; </div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        print <span class="stringliteral">&#39;&lt;td class=&quot;right&quot; width=&quot;100&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        print $value.<span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        print <span class="stringliteral">&#39;&lt;/td&gt;&lt;td class=&quot;center nowraponall&quot; width=&quot;40&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <span class="keywordflow">if</span> ($value &lt; count($array_selected)) {</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;            print <span class="stringliteral">&#39;&lt;a href=&quot;&#39;</span>.$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&#39;?step=&#39;</span>.$step.<span class="stringliteral">&#39;&amp;datatoexport=&#39;</span>.$datatoexport.<span class="stringliteral">&#39;&amp;action=downfield&amp;field=&#39;</span>.$code.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a4e0640774b97d6bdcb99d862f6414625">img_down</a>().<span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        }</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        <span class="keywordflow">if</span> ($value &gt; 1) {</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            print <span class="stringliteral">&#39;&lt;a href=&quot;&#39;</span>.$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&#39;?step=&#39;</span>.$step.<span class="stringliteral">&#39;&amp;datatoexport=&#39;</span>.$datatoexport.<span class="stringliteral">&#39;&amp;action=upfield&amp;field=&#39;</span>.$code.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#aee5cb1d010af93e73c39fee71487ea7b">img_up</a>().<span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        }</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160; </div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        <span class="comment">//print &#39;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&#39;;</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        <span class="comment">//print &#39;&lt;td&gt;&#39;.$langs-&gt;trans($objexport-&gt;array_export_fields[0][$code]).&#39;&lt;/td&gt;&#39;;</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160; </div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        print <span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    }</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160; </div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    print <span class="stringliteral">&#39;&lt;/table&gt;&#39;</span>;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160; </div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160; </div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="comment">     * Action bar</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;tabsAction&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160; </div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="keywordflow">if</span> (count($array_selected)) {</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        print <span class="stringliteral">&#39;&lt;a class=&quot;butAction&quot; href=&quot;export.php?step=&#39;</span>.($step + 1).<span class="stringliteral">&#39;&amp;datatoexport=&#39;</span>.$datatoexport.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;NextStep&quot;</span>).<span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    }</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; </div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160; </div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160; </div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="comment">// Area for profils export</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordflow">if</span> (count($array_selected)) {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        print <span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160; </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        print <span class="stringliteral">&#39;&lt;div class=&quot;marginbottomonly&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        print <span class="stringliteral">&#39;&lt;span class=&quot;opacitymedium&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;SaveExportModel&quot;</span>).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160; </div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        print <span class="stringliteral">&#39;&lt;form class=&quot;nocellnopadd&quot; action=&quot;export.php&quot; method=&quot;post&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;&#39;</span>.newToken().<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;action&quot; value=&quot;add_export_model&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;step&quot; value=&quot;&#39;</span>.$step.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;datatoexport&quot; value=&quot;&#39;</span>.$datatoexport.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;hexa&quot; value=&quot;&#39;</span>.$hexa.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160; </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        print <span class="stringliteral">&#39;&lt;div class=&quot;div-table-responsive-no-min&quot;&gt;&#39;</span>; <span class="comment">// You can use div-table-responsive-no-min if you dont need reserved height for your table</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        print <span class="stringliteral">&#39;&lt;table class=&quot;noborder centpercent&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        print <span class="stringliteral">&#39;&lt;tr class=&quot;liste_titre&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ExportModelName&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Visibility&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        print <span class="stringliteral">&#39;&lt;td&gt;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        print <span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160; </div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        print <span class="stringliteral">&#39;&lt;tr class=&quot;oddeven&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        print <span class="stringliteral">&#39;&lt;td&gt;&lt;input name=&quot;export_name&quot; value=&quot;&quot;&gt;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        $arrayvisibility = array(<span class="stringliteral">&#39;private&#39;</span>=&gt;$langs-&gt;trans(<span class="stringliteral">&quot;Private&quot;</span>), <span class="stringliteral">&#39;all&#39;</span>=&gt;$langs-&gt;trans(<span class="stringliteral">&quot;Everybody&quot;</span>));</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        print $form-&gt;selectarray(<span class="stringliteral">&#39;visibility&#39;</span>, $arrayvisibility, <span class="stringliteral">&#39;private&#39;</span>);</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        print <span class="stringliteral">&#39;&lt;td class=&quot;right&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        print <span class="stringliteral">&#39;&lt;input type=&quot;submit&quot; class=&quot;button reposition button-save&quot; value=&quot;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Save&quot;</span>).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        print <span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160; </div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        $tmpuser = <span class="keyword">new</span> <a class="code" href="../../d7/d23/class_user.html">User</a>($db);</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160; </div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <span class="comment">// List of existing export profils</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        $sql = <span class="stringliteral">&quot;SELECT rowid, label, fk_user, entity&quot;</span>;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        $sql .= <span class="stringliteral">&quot; FROM &quot;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&quot;export_model&quot;</span>;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        $sql .= <span class="stringliteral">&quot; WHERE type = &#39;&quot;</span>.$db-&gt;escape($datatoexport).<span class="stringliteral">&quot;&#39;&quot;</span>;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        <span class="keywordflow">if</span> (empty($conf-&gt;global-&gt;EXPORTS_SHARE_MODELS)) {   <span class="comment">// EXPORTS_SHARE_MODELS means all templates are visible, whatever is owner.</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;            $sql .= <span class="stringliteral">&quot; AND fk_user IN (0, &quot;</span>.((int) $user-&gt;id).<span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        }</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;        $sql .= <span class="stringliteral">&quot; ORDER BY rowid&quot;</span>;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        <a class="code" href="../../d9/d3c/compta_2index_8php.html#a14a5de89426ca4a6f25720be81061c90">$resql</a> = $db-&gt;query($sql);</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3c/compta_2index_8php.html#a14a5de89426ca4a6f25720be81061c90">$resql</a>) {</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;            $num = $db-&gt;num_rows(<a class="code" href="../../d9/d3c/compta_2index_8php.html#a14a5de89426ca4a6f25720be81061c90">$resql</a>);</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;            $i = 0;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;            <span class="keywordflow">while</span> ($i &lt; $num) {</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                $obj = $db-&gt;fetch_object(<a class="code" href="../../d9/d3c/compta_2index_8php.html#a14a5de89426ca4a6f25720be81061c90">$resql</a>);</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160; </div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                print <span class="stringliteral">&#39;&lt;tr class=&quot;oddeven&quot;&gt;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                print $obj-&gt;label;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                <span class="keywordflow">if</span> (empty($obj-&gt;fk_user)) {</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                    print $langs-&gt;trans(<span class="stringliteral">&quot;Everybody&quot;</span>);</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                    $tmpuser-&gt;fetch($obj-&gt;fk_user);</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                    print $tmpuser-&gt;getNomUrl(1);</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                }</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;                print <span class="stringliteral">&#39;&lt;td class=&quot;right&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                print <span class="stringliteral">&#39;&lt;a class=&quot;reposition&quot; href=&quot;&#39;</span>.$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&#39;?step=&#39;</span>.$step.<span class="stringliteral">&#39;&amp;datatoexport=&#39;</span>.$datatoexport.<span class="stringliteral">&#39;&amp;action=deleteprof&amp;token=&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a6d79bb77d4de9606546ddfccacf358f9">newToken</a>().<span class="stringliteral">&#39;&amp;id=&#39;</span>.$obj-&gt;rowid.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a1c7e71301b0a54d23467e8c5658730a1">img_delete</a>();</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                print <span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                print <span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                $i++;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;            }</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;            <a class="code" href="../../d9/d69/functions_8lib_8php.html#a39a0441491a380f7f9fe07ee296cd2fa">dol_print_error</a>($db);</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        }</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160; </div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        print <span class="stringliteral">&#39;&lt;/table&gt;&#39;</span>;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160; </div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        print <span class="stringliteral">&#39;&lt;/form&gt;&#39;</span>;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    }</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;}</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160; </div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="keywordflow">if</span> ($step == 5 &amp;&amp; $datatoexport) {</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordflow">if</span> (count($array_selected) &lt; 1) {      <span class="comment">// This occurs when going back to page after sessecion expired</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        <span class="comment">// Switch to step 2</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        header(<span class="stringliteral">&quot;Location: &quot;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=2&amp;datatoexport=&#39;</span>.$datatoexport);</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        exit;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    }</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    asort($array_selected);</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160; </div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <a class="code" href="../../d6/d7c/asterisk_2wrapper_8php.html#abcab7df295b4869f8dfb1dd7059fd974">llxHeader</a>(<span class="stringliteral">&#39;&#39;</span>, $langs-&gt;trans(<span class="stringliteral">&quot;NewExport&quot;</span>), <span class="stringliteral">&#39;EN:Module_Exports_En|FR:Module_Exports|ES:M&amp;oacute;dulo_Exportaciones&#39;</span>);</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160; </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    $h = 0;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    $stepoffset = 0;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160; </div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    $head[$h][0] = DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=1&#39;</span>;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    $head[$h][1] = $langs-&gt;trans(<span class="stringliteral">&quot;Step&quot;</span>).<span class="stringliteral">&quot; 1&quot;</span>;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    $h++;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160; </div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    $head[$h][0] = DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=2&amp;datatoexport=&#39;</span>.$datatoexport;</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    $head[$h][1] = $langs-&gt;trans(<span class="stringliteral">&quot;Step&quot;</span>).<span class="stringliteral">&quot; 2&quot;</span>;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    $h++;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="comment">// si le filtrage est parametre pour l&#39;export ou pas</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="keywordflow">if</span> ($usefilters &amp;&amp; isset($objexport-&gt;array_export_TypeFields[0]) &amp;&amp; is_array($objexport-&gt;array_export_TypeFields[0])) {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        $head[$h][0] = DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=3&amp;datatoexport=&#39;</span>.$datatoexport;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        $head[$h][1] = $langs-&gt;trans(<span class="stringliteral">&quot;Step&quot;</span>).<span class="stringliteral">&quot; 3&quot;</span>;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        $h++;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        $stepoffset++;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    }</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160; </div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    $head[$h][0] = DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=4&amp;datatoexport=&#39;</span>.$datatoexport;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    $head[$h][1] = $langs-&gt;trans(<span class="stringliteral">&quot;Step&quot;</span>).<span class="stringliteral">&quot; &quot;</span>.(3 + $stepoffset);</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    $h++;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160; </div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    $head[$h][0] = DOL_URL_ROOT.<span class="stringliteral">&#39;/exports/export.php?step=5&amp;datatoexport=&#39;</span>.$datatoexport;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    $head[$h][1] = $langs-&gt;trans(<span class="stringliteral">&quot;Step&quot;</span>).<span class="stringliteral">&quot; &quot;</span>.(4 + $stepoffset);</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    $hselected = $h;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    $h++;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160; </div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a171b010d7ac532414a9027d005f16f78">dol_get_fiche_head</a>($head, $hselected, <span class="stringliteral">&#39;&#39;</span>, -2);</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160; </div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="comment">     * Confirmation suppression fichier</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="keywordflow">if</span> ($action == <span class="stringliteral">&#39;remove_file&#39;</span>) {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        print $form-&gt;formconfirm($_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&#39;?step=5&amp;datatoexport=&#39;</span>.$datatoexport.<span class="stringliteral">&#39;&amp;file=&#39;</span>.urlencode(<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;file&quot;</span>)), $langs-&gt;trans(<span class="stringliteral">&#39;DeleteFile&#39;</span>), $langs-&gt;trans(<span class="stringliteral">&#39;ConfirmDeleteFile&#39;</span>), <span class="stringliteral">&#39;confirm_deletefile&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, 0, 1);</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    }</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160; </div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;fichecenter&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;underbanner clearboth&quot;&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160; </div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    print <span class="stringliteral">&#39;&lt;table width=&quot;100%&quot; class=&quot;border tableforfield&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160; </div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="comment">// Module</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td class=&quot;titlefield&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Module&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <span class="comment">//print img_object($objexport-&gt;array_export_module[0]-&gt;getName(),$objexport-&gt;array_export_module[0]-&gt;picto).&#39; &#39;;</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    print $objexport-&gt;array_export_module[0]-&gt;getName();</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    print <span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160; </div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="comment">// Dataset to export</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;DatasetToExport&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    $entity = preg_replace(<span class="stringliteral">&#39;/:.*$/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $objexport-&gt;array_export_icon[0]);</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    $entityicon = strtolower(!empty($entitytoicon[$entity]) ? $entitytoicon[$entity] : $entity);</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a419171413de4ff6a584f2a3e5ad0408c">img_object</a>($objexport-&gt;array_export_module[0]-&gt;getName(), $entityicon).<span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    print $objexport-&gt;array_export_label[0];</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    print <span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160; </div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="comment">// List of exported fields</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ExportedFields&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    $list = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    <span class="keywordflow">foreach</span> ($array_selected as $code =&gt; $label) {</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;        $list .= (!empty($list) ? <span class="stringliteral">&#39;, &#39;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        $list .= $langs-&gt;trans($objexport-&gt;array_export_fields[0][$code]);</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    }</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$list.<span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160; </div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="comment">// List of filtered fields</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    <span class="keywordflow">if</span> (isset($objexport-&gt;array_export_TypeFields[0]) &amp;&amp; is_array($objexport-&gt;array_export_TypeFields[0])) {</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;FilteredFields&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        $list = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <span class="keywordflow">if</span> (!empty($array_filtervalue)) {</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;            <span class="keywordflow">foreach</span> ($array_filtervalue as $code =&gt; $value) {</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                <span class="keywordflow">if</span> (isset($objexport-&gt;array_export_fields[0][$code])) {</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                    $list .= ($list ? <span class="stringliteral">&#39;, &#39;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                    <span class="keywordflow">if</span> (isset($array_filtervalue[$code]) &amp;&amp; preg_match(<span class="stringliteral">&#39;/^\s*[&lt;&gt;]/&#39;</span>, $array_filtervalue[$code])) {</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                        $list .= $langs-&gt;trans($objexport-&gt;array_export_fields[0][$code]).(isset($array_filtervalue[$code]) ? $array_filtervalue[$code] : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                        $list .= $langs-&gt;trans($objexport-&gt;array_export_fields[0][$code]).<span class="stringliteral">&quot;=&#39;&quot;</span>.(isset($array_filtervalue[$code]) ? $array_filtervalue[$code] : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&quot;&#39;&quot;</span>;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;                    }</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;                }</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;            }</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        }</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.(!empty($list) ? $list : <span class="stringliteral">&#39;&lt;span class=&quot;opacitymedium&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;None&quot;</span>).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        print <span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    }</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160; </div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    print <span class="stringliteral">&#39;&lt;/table&gt;&#39;</span>;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160; </div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    print <span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160; </div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="comment">// List of available export formats</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    $htmltabloflibs = <span class="stringliteral">&#39;&lt;table class=&quot;noborder centpercent&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    $htmltabloflibs .= <span class="stringliteral">&#39;&lt;tr class=&quot;liste_titre&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    $htmltabloflibs .= <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;AvailableFormats&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    $htmltabloflibs .= <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;LibraryUsed&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    $htmltabloflibs .= <span class="stringliteral">&#39;&lt;td class=&quot;right&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;LibraryVersion&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    $htmltabloflibs .= <span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160; </div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    $liste = $objmodelexport-&gt;liste_modeles($db);</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    $listeall = $liste;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordflow">foreach</span> ($listeall as $key =&gt; $val) {</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/__\(Disabled\)__/&#39;</span>, $listeall[$key])) {</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;            $listeall[$key] = preg_replace(<span class="stringliteral">&#39;/__\(Disabled\)__/&#39;</span>, <span class="charliteral">&#39;(&#39;</span>.$langs-&gt;transnoentitiesnoconv(<span class="stringliteral">&quot;Disabled&quot;</span>).<span class="charliteral">&#39;)&#39;</span>, $listeall[$key]);</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;            unset($liste[$key]);</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;        }</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160; </div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;        $htmltabloflibs .= <span class="stringliteral">&#39;&lt;tr class=&quot;oddeven&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;        $htmltabloflibs .= <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.img_picto_common($key, $objmodelexport-&gt;getPictoForKey($key)).<span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;        $text = $objmodelexport-&gt;getDriverDescForKey($key);</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;        $label = $listeall[$key];</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        $htmltabloflibs .= $form-&gt;textwithpicto($label, $text).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        $htmltabloflibs .= <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$objmodelexport-&gt;getLibLabelForKey($key).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        $htmltabloflibs .= <span class="stringliteral">&#39;&lt;td class=&quot;right&quot;&gt;&#39;</span>.$objmodelexport-&gt;getLibVersionForKey($key).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        $htmltabloflibs .= <span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    }</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    $htmltabloflibs .= <span class="stringliteral">&#39;&lt;/table&gt;&#39;</span>;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160; </div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    print <span class="stringliteral">&#39;&lt;span class=&quot;opacitymedium&quot;&gt;&#39;</span>.$form-&gt;textwithpicto($langs-&gt;trans(<span class="stringliteral">&quot;NowClickToGenerateToBuildExportFile&quot;</span>), $htmltabloflibs, 1, <span class="stringliteral">&#39;help&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, 0, 2, <span class="stringliteral">&#39;helphonformat&#39;</span>).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="comment">//print $htmltabloflibs;</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    print <span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160; </div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160; </div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160; </div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    <span class="keywordflow">if</span> ($sqlusedforexport &amp;&amp; $user-&gt;admin) {</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a7ec15a8e7d64b5ccc7abb996cb8238b2">info_admin</a>($langs-&gt;trans(<span class="stringliteral">&quot;SQLUsedForExport&quot;</span>).<span class="stringliteral">&#39;:&lt;br&gt; &#39;</span>.$sqlusedforexport, 0, 0, 1, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;TechnicalInformation&#39;</span>);</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    }</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160; </div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160; </div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="keywordflow">if</span> (!is_dir($conf-&gt;export-&gt;dir_temp)) {</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        <a class="code" href="../../d9/d69/functions_8lib_8php.html#a5005784a3917af00260371964471fe2f">dol_mkdir</a>($conf-&gt;export-&gt;dir_temp);</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    }</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160; </div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="comment">// Show existing generated documents</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="comment">// NB: La fonction show_documents rescanne les modules qd genallowed=1, sinon prend $liste</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    print $formfile-&gt;showdocuments(<span class="stringliteral">&#39;export&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $upload_dir, $_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&#39;?step=5&amp;datatoexport=&#39;</span>.$datatoexport, $liste, 1, (!empty($_POST[<span class="stringliteral">&#39;model&#39;</span>]) ? $_POST[<span class="stringliteral">&#39;model&#39;</span>] : <span class="stringliteral">&#39;csv&#39;</span>), 1, 1, 0, 0, 0, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;none&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;}</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160; </div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<a class="code" href="../../d6/d7c/asterisk_2wrapper_8php.html#aebbb85b0adc465834787866f31885fc5">llxFooter</a>();</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160; </div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;$db-&gt;close();</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160; </div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;exit; <span class="comment">// don&#39;t know why but apache hangs with php 5.3.10-1ubuntu3.12 and apache 2.2.2 if i remove this exit or replace with return</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160; </div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160; </div>
<div class="line"><a name="l01232"></a><span class="lineno"><a class="line" href="../../d2/db0/exports_2export_8php.html#a65f277b3c1bbf9bac086a95503df067a"> 1232</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d2/db0/exports_2export_8php.html#a65f277b3c1bbf9bac086a95503df067a">getablenamefromfield</a>($code, $sqlmaxforexport)</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;{</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    $alias = preg_replace(<span class="stringliteral">&#39;/\.(.*)$/i&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $code); <span class="comment">// Keep only &#39;Alias&#39; and remove &#39;.Fieldname&#39;</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    $regexstring = <span class="stringliteral">&#39;/([a-zA-Z_]+) as &#39;</span>.preg_quote($alias).<span class="stringliteral">&#39;[, \)]/i&#39;</span>;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160; </div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    $newsql = $sqlmaxforexport;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    $newsql = preg_replace(<span class="stringliteral">&#39;/^(.*) FROM /i&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $newsql); <span class="comment">// Remove part before the FROM</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    $newsql = preg_replace(<span class="stringliteral">&#39;/WHERE (.*)$/i&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $newsql); <span class="comment">// Remove part after the WHERE so we have now only list of table aliases in a string. We must keep the &#39; &#39; before WHERE</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160; </div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <span class="keywordflow">if</span> (preg_match($regexstring, $newsql, $reg)) {</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;        <span class="keywordflow">return</span> $reg[1]; <span class="comment">// The tablename</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    }</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="asecurity_8lib_8php_html_afd89914949e917d88361cf841a6f7d64"><div class="ttname"><a href="../../dd/df3/security_8lib_8php.html#afd89914949e917d88361cf841a6f7d64">restrictedArea</a></div><div class="ttdeci">restrictedArea($user, $features, $objectid=0, $tableandshare='', $feature2='', $dbt_keyfield='fk_soc', $dbt_select='rowid', $isdraft=0, $mode=0)</div><div class="ttdoc">Check permissions of a user to show a page and an object.</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/df3/security_8lib_8php_source.html#l00192">security.lib.php:192</a></div></div>
<div class="ttc" id="aasterisk_2wrapper_8php_html_aebbb85b0adc465834787866f31885fc5"><div class="ttname"><a href="../../d6/d7c/asterisk_2wrapper_8php.html#aebbb85b0adc465834787866f31885fc5">llxFooter</a></div><div class="ttdeci">llxFooter()</div><div class="ttdoc">Empty footer.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d7c/asterisk_2wrapper_8php_source.html#l00073">wrapper.php:73</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a97dc8c4d4db97a060f48e220a1f9f293"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a></div><div class="ttdeci">GETPOST($paramname, $check='alphanohtml', $method=0, $filter=null, $options=null, $noreplace=0)</div><div class="ttdoc">Return value of a param into GET or POST supervariable.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l00391">functions.lib.php:391</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a39a0441491a380f7f9fe07ee296cd2fa"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a39a0441491a380f7f9fe07ee296cd2fa">dol_print_error</a></div><div class="ttdeci">dol_print_error($db='', $error='', $errors=null)</div><div class="ttdoc">Displays error message system with all the information to facilitate the diagnosis and the escalation...</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l04503">functions.lib.php:4503</a></div></div>
<div class="ttc" id="aclass_form_other_html"><div class="ttname"><a href="../../d0/dbd/class_form_other.html">FormOther</a></div><div class="ttdoc">Classe permettant la generation de composants html autre Only common components are here.</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dda/html_8formother_8class_8php_source.html#l00039">html.formother.class.php:39</a></div></div>
<div class="ttc" id="acompta_2index_8php_html_a14a5de89426ca4a6f25720be81061c90"><div class="ttname"><a href="../../d9/d3c/compta_2index_8php.html#a14a5de89426ca4a6f25720be81061c90">$resql</a></div><div class="ttdeci">if(!empty($conf-&gt;facture-&gt;enabled) &amp;&amp;!empty($user-&gt;rights-&gt;facture-&gt;lire)) if((!empty($conf-&gt;fournisseur-&gt;enabled) &amp;&amp;empty($conf-&gt;global-&gt;MAIN_USE_NEW_SUPPLIERMOD) &amp;&amp; $user-&gt;rights-&gt;fournisseur-&gt;facture-&gt;lire)||(!empty($conf-&gt;supplier_invoice-&gt;enabled) &amp;&amp; $user-&gt;rights-&gt;supplier_invoice-&gt;lire)) if(!empty($conf-&gt;don-&gt;enabled) &amp;&amp;!empty($user-&gt;rights-&gt;don-&gt;lire)) if(!empty($conf-&gt;tax-&gt;enabled) &amp;&amp;!empty($user-&gt;rights-&gt;tax-&gt;charges-&gt;lire)) if(!empty($conf-&gt;facture-&gt;enabled) &amp;&amp;!empty($conf-&gt;commande-&gt;enabled) &amp;&amp; $user-&gt;rights-&gt;commande-&gt;lire &amp;&amp;empty($conf-&gt;global-&gt;WORKFLOW_DISABLE_CREATE_INVOICE_FROM_ORDER)) $resql</div><div class="ttdoc">Social contributions to pay.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d3c/compta_2index_8php_source.html#l00733">index.php:733</a></div></div>
<div class="ttc" id="aclass_export_html"><div class="ttname"><a href="../../de/de5/class_export.html">Export</a></div><div class="ttdoc">Class to manage exports.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d60/export_8class_8php_source.html#l00031">export.class.php:31</a></div></div>
<div class="ttc" id="aexports_2export_8php_html_a65f277b3c1bbf9bac086a95503df067a"><div class="ttname"><a href="../../d2/db0/exports_2export_8php.html#a65f277b3c1bbf9bac086a95503df067a">getablenamefromfield</a></div><div class="ttdeci">getablenamefromfield($code, $sqlmaxforexport)</div><div class="ttdoc">Return table name of an alias.</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db0/exports_2export_8php_source.html#l01232">export.php:1232</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a1bddcdff388341b5a9b49308fb402abd"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a1bddcdff388341b5a9b49308fb402abd">img_left</a></div><div class="ttdeci">img_left($titlealt='default', $selected=0, $moreatt='')</div><div class="ttdoc">Show left arrow logo.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l04293">functions.lib.php:4293</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a64fc44ee4f3329fe0ff256b57bffc128"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a64fc44ee4f3329fe0ff256b57bffc128">img_picto</a></div><div class="ttdeci">img_picto($titlealt, $picto, $moreatt='', $pictoisfullpath=false, $srconly=0, $notitle=0, $alt='', $morecss='', $marginleftonlyshort=2)</div><div class="ttdoc">Show picto whatever it's its name (generic function)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l03588">functions.lib.php:3588</a></div></div>
<div class="ttc" id="afiles_8lib_8php_html_a6cc4b8b038c2bfcc52c8a744a120a9c2"><div class="ttname"><a href="../../de/d28/files_8lib_8php.html#a6cc4b8b038c2bfcc52c8a744a120a9c2">dol_delete_file</a></div><div class="ttdeci">dol_delete_file($file, $disableglob=0, $nophperrors=0, $nohook=0, $object=null, $allowdotdot=false, $indexdatabase=1, $nolog=0)</div><div class="ttdoc">Remove a file or several files with a mask.</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d28/files_8lib_8php_source.html#l01166">files.lib.php:1166</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_aee5cb1d010af93e73c39fee71487ea7b"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#aee5cb1d010af93e73c39fee71487ea7b">img_up</a></div><div class="ttdeci">img_up($titlealt='default', $selected=0, $moreclass='')</div><div class="ttdoc">Show top arrow logo.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l04274">functions.lib.php:4274</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a1c7e71301b0a54d23467e8c5658730a1"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a1c7e71301b0a54d23467e8c5658730a1">img_delete</a></div><div class="ttdeci">img_delete($titlealt='default', $other='class=&quot;pictodelete&quot;', $morecss='')</div><div class="ttdoc">Show delete logo.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l04088">functions.lib.php:4088</a></div></div>
<div class="ttc" id="aclass_form_file_html"><div class="ttname"><a href="../../de/d23/class_form_file.html">FormFile</a></div><div class="ttdoc">Class to offer components to list and upload files.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d98/html_8formfile_8class_8php_source.html#l00036">html.formfile.class.php:36</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a5005784a3917af00260371964471fe2f"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a5005784a3917af00260371964471fe2f">dol_mkdir</a></div><div class="ttdeci">dol_mkdir($dir, $dataroot='', $newmask=null)</div><div class="ttdoc">Creation of a directory (this can create recursive subdir)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l06244">functions.lib.php:6244</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_af601a73af63cca748b9a57e810259372"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a></div><div class="ttdeci">dol_syslog($message, $level=LOG_INFO, $ident=0, $suffixinfilename='', $restricttologhandler='', $logcontext=null)</div><div class="ttdoc">Write log message into outputs.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l01447">functions.lib.php:1447</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a4e0640774b97d6bdcb99d862f6414625"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a4e0640774b97d6bdcb99d862f6414625">img_down</a></div><div class="ttdeci">img_down($titlealt='default', $selected=0, $moreclass='')</div><div class="ttdoc">Show down arrow logo.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l04255">functions.lib.php:4255</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a171b010d7ac532414a9027d005f16f78"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a171b010d7ac532414a9027d005f16f78">dol_get_fiche_head</a></div><div class="ttdeci">dol_get_fiche_head($links=array(), $active='', $title='', $notab=0, $picto='', $pictoisfullpath=0, $morehtmlright='', $morecss='', $limittoshow=0, $moretabssuffix='')</div><div class="ttdoc">Show tabs of a record.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l01621">functions.lib.php:1621</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a6d79bb77d4de9606546ddfccacf358f9"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a6d79bb77d4de9606546ddfccacf358f9">newToken</a></div><div class="ttdeci">newToken()</div><div class="ttdoc">Return the value of token currently saved into session with name 'newtoken'.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l10301">functions.lib.php:10301</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a43ed6679bd4b390f7b120bf848d5acf9"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a43ed6679bd4b390f7b120bf848d5acf9">dol_get_fiche_end</a></div><div class="ttdeci">dol_get_fiche_end($notab=0)</div><div class="ttdoc">Return tab footer of a card.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l01812">functions.lib.php:1812</a></div></div>
<div class="ttc" id="aclass_user_html"><div class="ttname"><a href="../../d7/d23/class_user.html">User</a></div><div class="ttdoc">Class to manage Dolibarr users.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/da1/user_8class_8php_source.html#l00044">user.class.php:44</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_aca64a844ce2ad30d4fc49cd4b957cbdf"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a></div><div class="ttdeci">GETPOSTISSET($paramname)</div><div class="ttdoc">Return true if we are in a context of submitting the parameter $paramname from a POST of a form.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l00321">functions.lib.php:321</a></div></div>
<div class="ttc" id="aclass_form_html"><div class="ttname"><a href="../../df/d08/class_form.html">Form</a></div><div class="ttdoc">Class to manage generation of HTML components Only common components must be here.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d05/html_8form_8class_8php_source.html#l00052">html.form.class.php:52</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a419171413de4ff6a584f2a3e5ad0408c"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a419171413de4ff6a584f2a3e5ad0408c">img_object</a></div><div class="ttdeci">img_object($titlealt, $picto, $moreatt='', $pictoisfullpath=false, $srconly=0, $notitle=0)</div><div class="ttdoc">Show a picto called object_picto (generic function)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l03870">functions.lib.php:3870</a></div></div>
<div class="ttc" id="aclass_modele_exports_html"><div class="ttname"><a href="../../d5/d32/class_modele_exports.html">ModeleExports</a></div><div class="ttdoc">Parent class for export modules.</div><div class="ttdef"><b>Definition:</b> <a href="../../da/de6/modules__export_8php_source.html#l00031">modules_export.php:31</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a4a25c44d5cda2ec236161511fadde188"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a></div><div class="ttdeci">setEventMessages($mesg, $mesgs, $style='mesgs', $messagekey='')</div><div class="ttdoc">Set event messages in dol_events session object.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l07668">functions.lib.php:7668</a></div></div>
<div class="ttc" id="aasterisk_2wrapper_8php_html_abcab7df295b4869f8dfb1dd7059fd974"><div class="ttname"><a href="../../d6/d7c/asterisk_2wrapper_8php.html#abcab7df295b4869f8dfb1dd7059fd974">llxHeader</a></div><div class="ttdeci">if(!defined('NOREQUIRESOC')) if(!defined('NOREQUIRETRAN')) if(!defined('NOCSRFCHECK')) if(!defined('NOTOKENRENEWAL')) if(!defined('NOREQUIREMENU')) if(!defined('NOREQUIREHTML')) if(!defined('NOREQUIREAJAX')) llxHeader()</div><div class="ttdoc">Empty header.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d7c/asterisk_2wrapper_8php_source.html#l00059">wrapper.php:59</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a7ec15a8e7d64b5ccc7abb996cb8238b2"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a7ec15a8e7d64b5ccc7abb996cb8238b2">info_admin</a></div><div class="ttdeci">info_admin($text, $infoonimgalt=0, $nodiv=0, $admin='1', $morecss='', $textfordropdown='')</div><div class="ttdoc">Show information for admin users or standard users.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l04459">functions.lib.php:4459</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a15ee713320bf5a7b4ea2a8d9401787c6"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a15ee713320bf5a7b4ea2a8d9401787c6">img_right</a></div><div class="ttdeci">img_right($titlealt='default', $selected=0, $moreatt='')</div><div class="ttdoc">Show right arrow logo.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l04312">functions.lib.php:4312</a></div></div>
<!-- 
File added into doxygen generated documentation
-->
<hr class="footer" />
<address class="footer"><small>Generated on Tue Oct 19 2021 22:52:56 for <a href="https://www.dolibarr.org" title="ERP and CRM open source software">Dolibarr</a> by Doxygen 1.8.17 </small></address>
<br>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-9049390-16"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-9049390-16');
</script>
</body>
</html>